{% extends 'hod_template/base_template.html' %} {% load static %} {% block page_title %} Seat Plan {% endblock page_title %} {% block main_content %}

<style>
  .bus-column {
    width: 400px;
  }

  .first-column {
    padding-right: 20px;
  }

  .column-no p span {
    font-size: 18px;
    font-weight: 600;
  }

  .seat {
    position: relative;
    width: 40px;
    height: 40px;
    margin: 5px;
    border-radius: 5px;
    cursor: pointer;
  }

  .seat-label-div {
    position: absolute;
    top: 0;
    width: 100%;
    height: 100%;
    transform: scale(0);
    pointer-events: none;
  }

  .seat-label {
    position: relative;
    top: -4px;
    color: white;
    font-size: 14px;
    font-weight: 600;
    z-index: 1;
  }

  .seat-color {
    color: rgb(172, 164, 164);
  }

  .selected {
    color: rgb(22, 206, 53);
  }

  .fa-couch {
    padding-left: 4px;
  }

  /* .fa-couch:hover + .seat-label-div{
        transform: scale(1.0);
    } */

  /* .fa-couch:hover{
        color: rgb(22, 206, 53);
    } */

  /* .fa-couch.selected {
        color: rgb(22, 206, 53);
    }
      
      .fa-couch.selected + .seat-label-div {
        transform: scale(1.0);
    } */

  .fa-lg {
    font-size: 25px;
  }

  .wheel {
    width: 100%;
  }

  .entry-image {
    width: 30px;
  }

  .row-name {
    width: 40px;
    height: 40px;
  }

  .row-name p {
    padding-top: 5px;
  }

  .row-name p span {
    font-size: 18px;
    font-weight: 600;
  }

  /* .seat-image{
        width: 100%;
        background-color: red;
    } */

  /* Seat View */

  .seat-view {
    margin-top: 80px;
  }

  .tab-div p span {
    font-size: 14px;
    padding-top: 3%;
  }

  .seat-view-table-row td {
    font-size: 14px;
  }

  .dropdown-menu {
    width: 95%;
    border: 1px solid rgb(166, 188, 228);
  }

  .dropdown-toggle::after {
    margin-top: 10px;
  }

  .dropdown-btn {
    border: 1px solid rgb(166, 188, 228);
  }

  .booked-seat {
    color: rgb(230, 94, 94);
  }
</style>
<!-- Main content -->
<section class="content">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <!-- Search form -->
        <form method="GET" action="{% url 'bus_detail' bus_id=bus_id %}">
          <input type="text" name="bus_number" placeholder="Enter Bus Number" />
          <button type="submit">Search</button>
        </form>
      </div>
    </div>

    {% if bus_number %}
    <!-- Display bus number -->
    <h4>Bus Number: {{ bus_number }}</h4>
    {% endif %}

    <div class="row">
      <div class="bus-column col-lg-3 col-md-5 col-12">
        <h3>Seat Plan</h3>
        <ul>
          {% for seat_type in seat_types %} {% if seat_type.type == '2:2' %}
          <!-- Render 2:2 seat type -->
          {% for row_num in seat_type.rows %}
          <div class="row w-100">
            <div class="col-6 d-flex">
              <div class="col-4">
                <div class="seat">
                  <i
                    id="{{ row_num }}1"
                    class="fa-solid fa-couch seat-select fa-lg seat-color"
                  ></i>
                  <div class="d-flex justify-content-center seat-label-div">
                    <span class="seat-label">{{ row_num }}1</span>
                  </div>
                </div>
              </div>
              <div class="col-4">
                <div class="seat">
                  <i
                    id="{{ row_num }}2"
                    class="fa-solid fa-couch seat-select fa-lg seat-color"
                  ></i>
                  <div class="d-flex justify-content-center seat-label-div">
                    <span class="seat-label">{{ row_num }}2</span>
                  </div>
                </div>
              </div>
              <div class="col-2"></div>
              <div class="col-4">
                <div class="seat">
                  <i
                    id="{{ row_num }}3"
                    class="fa-solid fa-couch seat-select fa-lg seat-color"
                  ></i>
                  <div class="d-flex justify-content-center seat-label-div">
                    <span class="seat-label">{{ row_num }}3</span>
                  </div>
                </div>
              </div>
              <div class="col-4">
                <div class="seat">
                  <i
                    id="{{ row_num }}4"
                    class="fa-solid fa-couch seat-select fa-lg seat-color"
                  ></i>
                  <div class="d-flex justify-content-center seat-label-div">
                    <span class="seat-label">{{ row_num }}4</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          {% endfor %} {% elif seat_type.type == '1:2' %}
          <!-- Render 1:2 seat type -->
          {% for row_num in seat_type.rows %}
          <div class="row w-100">
            <div class="col-6 d-flex">
              <div class="col-4">
                <div class="seat">
                  <i
                    id="{{ row_num }}1"
                    class="fa-solid fa-couch seat-select fa-lg seat-color"
                  ></i>
                  <div class="d-flex justify-content-center seat-label-div">
                    <span class="seat-label">{{ row_num }}1</span>
                  </div>
                </div>
              </div>
              <div class="col-2"></div>
              <div class="col-2"></div>
              <div class="col-2"></div>
              <div class="col-4">
                <div class="seat">
                  <i
                    id="{{ row_num }}2"
                    class="fa-solid fa-couch seat-select fa-lg seat-color"
                  ></i>
                  <div class="d-flex justify-content-center seat-label-div">
                    <span class="seat-label">{{ row_num }}2</span>
                  </div>
                </div>
              </div>

              <div class="col-4">
                <div class="seat">
                  <i
                    id="{{ row_num }}3"
                    class="fa-solid fa-couch seat-select fa-lg seat-color"
                  ></i>
                  <div class="d-flex justify-content-center seat-label-div">
                    <span class="seat-label">{{ row_num }}3</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          {% endfor %} {% elif seat_type.type == '1:1' %}
          <!-- Render 1:1 seat type -->
          {% for row_num in seat_type.rows %}
          
          <div class="row w-100">
            <div class="col-0.9"></div>
            <div class="col-5">
              <!-- Right-side seat -->
              <div class="seat">
                <i
                  id="{{ row_num }}1"
                  class="fa-solid fa-couch seat-select fa-lg seat-color"
                ></i>
                <div class="d-flex justify-content-center seat-label-div">
                  <span class="seat-label">{{ row_num }}1</span>
                </div>
              </div>
            </div>
            <div class="col-1"></div>
            <div class="col-4">
              <!-- Left-side seat -->
              <div class="seat">
                <i
                  id="{{ row_num }}2"
                  class="fa-solid fa-couch seat-select fa-lg seat-color"
                ></i>
                <div class="d-flex justify-content-center seat-label-div">
                  <span class="seat-label">{{ row_num }}2</span>
                </div>
              </div>
            </div>
          </div>
          {% endfor %} {% elif seat_type.type == 'Mixed' %}
          <!-- Render Mixed seat type -->
          {% for row_num in seat_type.rows %}
          <div class="row w-100">
            <div class="col-2">
              <div class="row-name">
                <p><span>{{ row_num }}</span></p>
              </div>
            </div>
            <div class="col-6 d-flex">
              <div class="col-4">
                <div class="seat">
                  <i
                    id="{{ row_num }}1"
                    class="fa-solid fa-couch seat-select fa-lg seat-color"
                  ></i>
                  <div class="d-flex justify-content-center seat-label-div">
                    <span class="seat-label">{{ row_num }}1</span>
                  </div>
                </div>
              </div>

              <div class="col-4">
                <div class="seat">
                  <i
                    id="{{ row_num }}2"
                    class="fa-solid fa-couch seat-select fa-lg seat-color"
                  ></i>
                  <div class="d-flex justify-content-center seat-label-div">
                    <span class="seat-label">{{ row_num }}2</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          {% endfor %} {% endif %} {% endfor %}
        </ul>
      </div>
      <div class="seat-view col-lg-5 col-md-7 col-12">
        <div class="row">
          <div class="tab-div col-4 d-flex">
            <span
              ><i
                class="fa-solid fa-couch fa-sm"
                style="color: rgb(172, 164, 164)"
              ></i
            ></span>
            <p class="ms-3"><span>Available Seats</span></p>
          </div>
          <div class="tab-div col-4 d-flex">
            <span
              ><i
                class="fa-solid fa-couch fa-sm"
                style="color: rgb(230, 94, 94)"
              ></i
            ></span>
            <p class="ms-3"><span>Booked Seats</span></p>
          </div>
          <div class="tab-div col-4 d-flex">
            <span
              ><i
                class="fa-solid fa-couch fa-sm"
                style="color: rgb(22, 206, 53)"
              ></i
            ></span>
            <p class="ms-3"><span>Selected Seats</span></p>
          </div>
        </div>
        <div class="row">
          <div class="table-responsive">
            <table id="seat-view-table" class="table">
              <thead>
                <tr>
                  <th class="col-4" scope="col">Seat</th>
                  <th class="col-4 ps-2" scope="col">Fare (BDT)</th>
                  <th class="col-4 ps-4" scope="col">Class</th>
                </tr>
              </thead>
              <tbody id="seat-view-table" class="w-100">
                <!-- Seat view table content goes here -->
              </tbody>
            </table>
          </div>
        </div>
        <div class="row mt-4">
          <div class="col-6">
            <p><span>Total:</span></p>
          </div>
          <div class="col-6 d-flex justify-content-end">
            <p>Tk <span id="total-fare">650.00</span></p>
          </div>
        </div>
        <div class="row mt-3">
          <select id="boardingpoint" name="boardingpoint" class="form-control">
            <option value="0">-- Boarding points --</option>
            <option value="137108507">Abdullahpur Bus Point (06:30 AM)</option>
            <option value="137108531">.Norda Bus Point. (07:00 AM)</option>
            <option value="137108525">Fokirapool Bus Point (07:15 AM)</option>
            <option value="137108526">Sayedabad Bus Point (07:30 AM)</option>
            <option value="137108528">Arambag Bus Point (07:30 AM)</option>
          </select>
        </div>
        <div class="row mt-4">
          <button
            id="booking-process"
            class="btn btn-primary continue-btn col-6"
          >
            Continue
          </button>
        </div>
      </div>
    </div>
  </div>
</section>
<script
  src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
  crossorigin="anonymous"
></script>
<script type="text/javascript">
  var seats = document.getElementsByClassName("seat-select");
  var selectedSeat = null;
  var selectedSeats = [];
  var maxSeats = 4;

  for (var i = 0; i < seats.length; i++) {
    seats[i].addEventListener("mouseover", function () {
      this.nextElementSibling.style.transform = "scale(1)";
      this.style.color = "rgb(22, 206, 53)";
    });

    seats[i].addEventListener("mouseout", function () {
      if (this.classList.contains("selected")) {
        this.nextElementSibling.style.transform = "scale(1)";
        this.style.color = "rgb(22, 206, 53)";
      } else {
        this.nextElementSibling.style.transform = "scale(0)";
        this.style.color = "";
      }
    });
  }

  function toggleSeat() {
    // for (var i = 0; i < seats.length; i++) {
    //     seats[i].classList.remove("selected");
    // }

    // remove the class 'selected', if already selected

    if (this.classList.contains("selected")) {
      this.classList.remove("selected");

      var rowId = document.getElementById("seat-" + this.id);
      if (rowId) {
        rowId.remove();
      }
      console.log("Not selected");
      selectedSeats.splice(selectedSeats.indexOf(this), 1);
    }

    // maximum of four seats can be selected
    else {
      if (selectedSeats.length < maxSeats) {
        this.classList.add("selected");
        console.log("Has selected");

        // If a seat is selected the seat is added in the table
        var tableBody = document.getElementById("seat-view-table");
        seatNumber = this.id;

        // creates a row
        var newRow = document.createElement("tr");
        newRow.id = "seat-" + this.id;
        // newRow.classList.add('d-flex')

        // creates a cell in the table
        var cell1 = document.createElement("td");
        cell1.classList.add("col-4");
        cell1.textContent = seatNumber;
        newRow.appendChild(cell1);

        // creates a cell in the table
        var cell2 = document.createElement("td");
        cell2.classList.add("col-4", "ps-2");
        cell2.textContent = parseFloat("100");
        newRow.appendChild(cell2);

        // creates a cell in the table
        var cell3 = document.createElement("td");
        cell3.classList.add("col-4", "ps-4");
        cell3.textContent = "First Class";
        newRow.appendChild(cell3);

        tableBody.appendChild(newRow);

        selectedSeats.push(this);
        console.log("selectedSeats: ", selectedSeats);
      } else {
        console.log("Maximum seat selection reached.");
      }
    }

    // show the seat no. if the seat is already selected or booked
    for (var i = 0; i < seats.length; i++) {
      if (seats[i].classList.contains("selected")) {
        seats[i].nextElementSibling.style.transform = "scale(1)";
      } else if (seats[i].classList.contains("booked-seat")) {
        seats[i].nextElementSibling.style.transform = "scale(1)";
        seats[i].parentElement.style.cursor = "default";
      } else {
        seats[i].nextElementSibling.style.transform = "scale(0)";
      }
    }

    var cell2Values = [];
    var cell2Elements = tableBody.querySelectorAll("td:nth-child(2)");
    console.log("cell2Elements: ", cell2Elements);
    totalAmount = 0;
    cell2Value = 0;
    var sum = 0;

    // sum the cell values of Cell 2 to get the sum of fare
    for (var i = 0; i < cell2Elements.length; i++) {
      var cell2Value = parseFloat(cell2Elements[i].textContent);
      // cell2Values.push(cell2Value);
      // sum += cell2Value;
      totalAmount += cell2Value;
    }

    console.log("cell2Values: ", cell2Values);
    totalFare = document.getElementById("total-fare");
    console.log("total fare: ", totalAmount);
    totalFare.textContent = totalAmount;
  }

  for (var i = 0; i < seats.length; i++) {
    seats[i].addEventListener("click", toggleSeat);
  }

  // Booking Process

  var continueBtn = document.getElementById("booking-process");

  function bookingProcess() {
    alert("Booking Sccessful");
    // for (var i = 0; i < seats.length; i++){
    //     console.log(seats[i])
    // }

    for (var i = 0; i < seats.length; i++) {
      if (seats[i].classList.contains("selected")) {
        seats[i].classList.remove("selected");
        seats[i].classList.add("booked-seat");

        seats[i].style.color = "rgb(230, 94, 94)";

        seats[i].style.cursor = "none";
        seats[i].style.pointerEvents = "none";

        console.log("Booking added");
        console.log(seats[i]);

        if (
          seats[i].classList.contains("booked-seat") &&
          selectedSeats.includes(seats[i])
        ) {
          console.log("true");
          selectedSeats = [];
        }
      }
    }
  }

  continueBtn.addEventListener("click", bookingProcess);
</script>
<!-- /.content -->
{% endblock main_content %}
