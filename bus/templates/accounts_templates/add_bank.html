{% extends 'accounts_templates/accounts_base.html' %}
{% load static %}
{% block custom_css %}
<link rel="stylesheet" href="{% static "dist/css/add_product.css" %}">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr@4.6.9/dist/flatpickr.min.css">
{% endblock custom_css %}
{% block page_title %}Seat Views{% endblock page_title %}
{% block main_content %}
<section class="content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Add Product</h3>
                    </div>
                    <div class="card-body">
                        {% if messages %}
                        {% for message in messages %}
                            <div class="alert {% if message.tags %}{% if message.tags == 'success' %}alert-success{% elif message.tags == 'error' %}alert-danger{% endif %}{% endif %}">
                                {{ message }}
                            </div>
                        {% endfor %}
                    {% endif %}

                        <div class="flex-container">
                            <form method="post">
                                {% csrf_token %}
                                <div class="row">
                                    <div class="col-4 mt-4">
                                        <div class="form-group">
                                            <label for="bank_name">Bank Name:</label>
                                            <input type="text" class="form-control" id="bank_name" name="bank_name" placeholder="Enter Bank Name" required>
                                        </div>
                                    </div>
                                    <div class="col-4 mt-4">
                                        <div class="form-group">
                                            <label for="branch">Branch:</label>
                                            <input type="text" class="form-control" id="branch" name="branch" placeholder="Enter Branch" required>
                                        </div>
                                    </div>
                                    <div class="col-4 mt-4">
                                        <div class="form-group">
                                            <label for="account_name">Account Name:</label>
                                            <input type="text" class="form-control" id="account_name" name="account_name" placeholder="Enter Account Name" required>
                                        </div>
                                    </div>
                                    <div class="col-4 mt-4">
                                        <div class="form-group">
                                            <label for="account_holder">Account Holder:</label>
                                            <input type="text" class="form-control" id="account_holder" name="account_holder" placeholder="Enter Account Holder" required>
                                        </div>
                                    </div>
                                    <div class="col-4 mt-4">
                                        <div class="form-group">
                                            <label for="account_no">Account No:</label>
                                            <input type="text" class="form-control" id="account_no" name="account_no" placeholder="Enter Account No" required>
                                        </div>
                                    </div>
                                    <div class="col-4 mt-4">
                                        <div class="form-group">
                                            <label for="phone_number">Phone:</label>
                                            <input type="text" class="form-control" id="phone_number" name="phone_number" placeholder="Enter Phone Number" required>
                                        </div>
                                    </div>
                                    <div class="col-4 mt-4">
                                        <div class="form-group">
                                            <label for="initial_balance">Initial Balance:</label>
                                            <input type="number" class="form-control" step="0.01" id="initial_balance" name="initial_balance" placeholder="Enter Initial Balance" required>
                                        </div>
                                    </div>
                                    <div class="col-4 mt-4">
                                        <div class="form-group">
                                            <label for="internet_banking_url">Internet Banking URL:</label>
                                            <input type="url" class="form-control" id="internet_banking_url" name="internet_banking_url" placeholder="Enter Internet Banking URL" required>
                                        </div>
                                    </div>
                                    <div class="col-4 mt-5">
                                        <div class="form-group mt-2 d-flex">
                                            <div class="form-check form-check-inline">
                                                <label class="mt-2">Status:</label>
                                            </div>
                                            <div class="form-check form-check-inline">
                                                <input type="checkbox" class="form-check-input" id="activeStatus" name="status" value="active" onclick="handleCheckboxClick('activeStatus')">
                                                <label class="form-check-label" for="activeStatus">Active</label>
                                            </div>
                                            <div class="form-check form-check-inline">
                                                <input type="checkbox" class="form-check-input" id="inactiveStatus" name="status" value="inactive" onclick="handleCheckboxClick('inactiveStatus')">
                                                <label class="form-check-label" for="inactiveStatus">Inactive</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <button type="submit" class="save-btn">Add Bank</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<script>
    function handleCheckboxClick(checkboxId) {
        var checkboxes = document.querySelectorAll('input[name="status"]');
        
        checkboxes.forEach(function(checkbox) {
            if (checkbox.id !== checkboxId) {
                checkbox.checked = false;
            }
        });
    }
</script>
<script>
    $(document).ready(function() {
        $("#id_email").keyup(function() {
        var email = $(this).val();
    
        if (email !== "") {
            $.ajax({
            url: "{% url 'check_email_exist' %}",
            type: "POST",
            data: { email: email }
            })
            .done(function(response) {
                console.log(response);
                if (response === "True") {
                $(".email_error").remove();
                $("<span class='email_error' style='padding: 5px;color: red;font-weight: bold;'>Email Not Available</span>").insertAfter("#id_email");
                $("#id_email").addClass("error-field");
                } else {
                $(".email_error").remove();
                $("<span class='email_error' style='padding: 5px;color: green;font-weight: bold;'>Email Available</span>").insertAfter("#id_email");
                $("#id_email").removeClass("error-field");
                }
            })
            .fail(function() {
                console.log("failed");
            });
        } else {
            $(".email_error").remove();
            $("#id_email").removeClass("error-field");
        }
        });
    
        $("#id_username").keyup(function() {
        var username = $(this).val();
    
        if (username !== "") {
            $.ajax({
            url: "{% url 'check_username_exist' %}",
            type: "POST",
            data: { username: username }
            })
            .done(function(response) {
                console.log(response);
                if (response === "True") {
                $(".username_error").remove();
                $("<span class='username_error' style='padding: 5px;color: red;font-weight: bold;'>Username Not Available</span>").insertAfter("#id_username");
                $("#id_username").addClass("error-field");
                } else {
                $(".username_error").remove();
                $("<span class='username_error' style='padding: 5px;color: green;font-weight: bold;'>Username Available</span>").insertAfter("#id_username");
                $("#id_username").removeClass("error-field");
                }
            })
            .fail(function() {
                console.log("failed");
            });
        } else {
            $(".username_error").remove();
            $("#id_username").removeClass("error-field");
        }
        });
    
        $("#phone_number").on("input", function() {
        var phoneNumber = $(this).val();
        var numericPhoneNumber = phoneNumber.replace(/\D/g, ""); // Remove non-digit characters
    
        $(this).val(numericPhoneNumber); // Update the input value with the numeric version
    
        // Check if the phone number length is not 11
        if (numericPhoneNumber.length !== 11) {
            $(".phone_error").remove();
            $(
            "<span class='phone_error' style='padding: 5px;color: red;font-weight: bold;'>Phone Number must be 11 digits</span>"
            ).insertAfter("#phone_number");
            $("#phone_number").addClass("error-field");
            return;
        }
    
        // Check if the phone number starts with the allowed prefixes
        var allowedPrefixes = ["019", "018", "017", "016", "013", "014"];
        var isValidPrefix = false;
    
        for (var i = 0; i < allowedPrefixes.length; i++) {
            if (numericPhoneNumber.startsWith(allowedPrefixes[i])) {
            isValidPrefix = true;
            break;
            }
        }
    
        if (!isValidPrefix) {
            $(".phone_error").remove();
            $(
            "<span class='phone_error' style='padding: 5px;color: red;font-weight: bold;'>invalid phone number format</span>"
            ).insertAfter("#phone_number");
            $("#phone_number").addClass("error-field");
            return;
        }
    
        // Phone number is valid, proceed with availability check
        $(".phone_error").remove();
        $("#phone_number").removeClass("error-field");
        $.ajax({
            url: "{% url 'check_phone_number_exist' %}",
            type: "POST",
            data: { phoneNumber: numericPhoneNumber },
        })
            .done(function(response) {
            console.log(response);
            if (response === "True") {
                $(
                "<span class='phone_error' style='padding: 5px;color: red;font-weight: bold;'>Phone Number Not Available</span>"
                ).insertAfter("#phone_number");
                $("#phone_number").addClass("error-field");
            } else {
                $(
                "<span class='phone_error' style='padding: 5px;color: green;font-weight: bold;'>Phone Number Available</span>"
                ).insertAfter("#phone_number");
                $("#phone_number").removeClass("error-field");
            }
            })
            .fail(function() {
            console.log("failed");
            });
        });
    
        // Variables for delay and timeout
        var delayTimer;
        var timeout = 300;
    
        // Function to handle suggestion request
        function performSuggestion(query) {
        $.ajax({
            url: "/staff_suggestion_view/",
            type: "GET",
            data: {
            query: query
            },
            success: function(response) {
            $("#suggestions").empty();
            $.each(response.suggestions, function(index, suggestion) {
                $("#suggestions").append("<p>" + suggestion + "</p>");
            });
            }
        });
        }
    
        // Function to handle search request
        function performSearch(query) {
        $.ajax({
            url: "/add_staff/",
            type: "GET",
            data: {
            query: query
            },
            success: function(response) {
            $("#search-results").html(response);
            }
        });
        }
    
        // Event handler for search form submission
        $("#search-form").on("submit", function(event) {
        event.preventDefault();
        var query = $("#search-input").val();
        performSearch(query);
        });
    
        // Event handler for search input keyup
        $("#search-input").on("keyup", function(event) {
        var query = $(this).val();
        clearTimeout(delayTimer);
        if (query) {
            delayTimer = setTimeout(function() {
            performSuggestion(query);
            }, timeout);
        } else {
            $("#suggestions").empty();
        }
        });
    
        // Event handler for form submission
        $("form").on("submit", function(event) {
        var isValid = true;
        if ($("#id_email").hasClass("error-field")) {
            isValid = false;
        }
        if ($("#id_username").hasClass("error-field")) {
            isValid = false;
        }
        if ($("#phone_number").hasClass("error-field")) {
            isValid = false;
        }
    
        if (!isValid) {
            event.preventDefault();
            $(".error-field").css("border-color", "red");
        }
        });
    });
    </script>
{% endblock main_content %}
