{% extends 'accounts_templates/accounts_base.html' %}
{% load static %}
{% block page_title %} Home {% endblock page_title %}
{% block custom_css %}
    <link rel="stylesheet" href="{% static "dist/css/home_content.css" %}">

    <style>
        #recentVouchersTable {
            /* Add any specific styles for the table */
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        #recentVouchersTable th,
        #recentVouchersTable td {
            /* Add styles for table header and data cells */
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        
        #recentVouchersTable th {
            /* Add styles for table header */
            background-color: #f2f2f2;
        }
        
        #recentVouchersBody tr:nth-child(even) {
            /* Add alternate row background color */
            background-color: #f9f9f9;
        }
        
        #recentVouchersBody tr:hover {
            /* Add hover effect */
            background-color: #e6f7ff;
        }

        /* Add these styles to your CSS file or within a style tag in your HTML file */

/* Style for the card */
.card-route {
    margin-top: 20px;
}

/* Style for the table */
.table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
}

/* Style for table header */
.table th {

    padding: 10px;
    text-align: left;
}

/* Style for table rows */
.table td, .table th {
    border: 1px solid #ddd;
    padding: 8px;
}

/* Style for alternating row colors */
.table tbody tr:nth-child(even) {
    background-color: #f2f2f2; /* Add your desired even row background color */
}

/* Style for hover effect on rows */
.table tbody tr:hover {
    background-color: #d3d3d3; /* Add your desired row hover background color */
}


.user-list-container {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-around;
    padding: 20px;
}

.user-container {
    border: 1px solid #ccc;
    margin: 10px;
    padding: 10px;
    text-align: center;
}

.profile-picture {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    margin-bottom: 10px;
}

.user-name {
    font-weight: bold;
    margin-bottom: 5px;
}

.sign-in-time,
.online,
.offline {
    font-size: 12px;
    color: #666;
}

.online {
    color: green;
}

.offline {
    color: red;
}
    </style>
{% endblock custom_css %}
 {% block main_content %}
    <!-- Main content -->
    <section class="content">
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-3 col-6">
                    <!-- small box -->
                    <div class="small-box bg-info card-1">
                        <div class="inner">
                            <h3><b>৳</b> {{total_transactions }}</h3>

                            <p>Total Transaction</p>
                        </div>
                        <div class="icon">
                            <i class="fa-solid fa-ticket fa-xl"></i>
                        </div>
                        <a href="{% url 'total_transactions' %}" class="small-box-footer"
                            >More info <i class="fas fa-arrow-circle-right"></i
                        ></a>
                    </div>
                </div>
                <!-- ./col -->
                <div class="col-lg-3 col-6">
                    <!-- small box -->
                    <div class="small-box bg-success card-2">
                        <div class="inner">
                            <h3><b>৳</b>{{ total_expenses }}</h3>

                            <p>Total Expense</p>
                        </div>
                        <div class="icon">
                            {% comment %} <i class="ion ion-pie-graph"></i> {% endcomment %}
                            <i class="fa-solid fa-money-bill"></i>
                        </div>
                        <a href="{% url 'total_expense' %}" class="small-box-footer">More info <i class="fas fa-arrow-circle-right"></i></a>
                    </div>
                </div>
                <!-- ./col -->
                <div class="col-lg-3 col-6">
                    <!-- small box -->
                    <div class="small-box bg-warning card-3">
                        <div class="inner">
                            <h3><b>৳</b>{{total_net_income}}</h3>

                            <p>Total Net Income</p>
                        </div>
                        <div class="icon">
                            {% comment %} <i class="ion ion-pie-graph"></i> {% endcomment %}
                            <i class="fas fa-money-bill-alt"></i>
                        </div>
                        <a href="{% url 'revenue_view' %}" class="small-box-footer">More info <i class="fas fa-arrow-circle-right"></i></a>
                    </div>
                </div>
                <!-- ./col -->
                <div class="col-lg-3 col-6">
                    <!-- small box -->
                    <div class="small-box bg-danger card-4">
                        <div class="inner">
                            <h3>{{ total_counter }}</h3>

                            <p>Total Counter</p>
                        </div>
                        <div class="icon">
                            {% comment %} <i class="ion ion-pie-graph"></i> {% endcomment %}
                            <i class="fa-solid fa-bus"></i>
                        </div>
                        <a href="{% url 'total_transactions' %}" class="small-box-footer">More info <i class="fas fa-arrow-circle-right"></i></a>
                    </div>
                </div>

            </div>
            <div class="row">
                <div class="col-lg-6">
                    <div class="card card-piechart">
                        <div class="card-header">
                            <h3 class="card-title">Piechart Report</h3>

                            <div class="card-tools">
                                <button type="button" class="btn btn-tool" data-card-widget="collapse">
                                    <i class="fas fa-minus"></i>
                                </button>
                                <button type="button" class="btn btn-tool" data-card-widget="remove">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <canvas
                                id="pieChart"
                                style="
                                  min-height: 250px;
                                  height: 250px;
                                  max-height: 250px;
                                  max-width: 100%;
                                "
                            ></canvas>
                        </div>
                    </div>
                </div>

                <div class="col-lg-6">
                    <div class="card cash-flow-chart-card">
                        <div class="card-header border-0">
                            <div class="d-flex justify-content-between">
                                <h3 class="card-title">Expense Vs Income</h3>
                                <a href="javascript:void(0);">View Report</a>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="position-relative mb-4">
                                <canvas id="cash-flow-chart" height="200"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            <div class="row">
                <div class="col-lg-6">
                    <div class="card card-info card-map">
                        <div class="card-header">
                            <h3 class="card-title">Map</h3>

                            <div class="card-tools">
                                <button
                                    type="button"
                                    class="btn btn-tool"
                                    data-card-widget="collapse"
                                >
                                    <i class="fas fa-minus"></i>
                                </button>
                                <button
                                    type="button"
                                    class="btn btn-tool"
                                    data-card-widget="remove"
                                >
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                          <div id="map" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="card card-warning card-customer-overview">
                        <div class="card-header">
                            <h3 class="card-title">Cash Chart</h3>
                            <div class="card-tools">
                                <button type="button" class="btn btn-tool" data-card-widget="collapse">
                                    <i class="fas fa-minus"></i>
                                </button>
                                <button type="button" class="btn btn-tool" data-card-widget="remove">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                        
                            <div id="incomeExpenseChart"></div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-6">
                        <div class="card card-success card-booking">
                            <div class="card-header">
                                <h3 class="card-title">User</h3>
                                <div class="card-tools">
                                    <button
                                        type="button"
                                        class="btn btn-tool"
                                        data-card-widget="collapse"
                                    >
                                        <i class="fas fa-minus"></i>
                                    </button>
                                    <button
                                        type="button"
                                        class="btn btn-tool"
                                        data-card-widget="remove"
                                    >
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <div id="userListContainer" style="height: 400px;">
                                    <div id="activeUserList"></div>

                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="card card-info card-route">
                            <div class="card-header">
                                <h3 class="card-title">Counter Credit Balances</h3>
                                <div class="card-tools">
                                
                                </div>
                            </div>
                            <div class="card-body">
                                <table class="table" id="counterCreditTable">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Credit Balance</th>
                                        </tr>
                                    </thead>
                                    <tbody id="counterCreditBody">
                                      
                                    </tbody>
                                </table>
                            </div>
                        </div>
                                <div class="card card-info card-route">
                                    <div class="card-header">
                                        <h3 class="card-title">Recent Bookings</h3>
                                        <div class="card-tools">
                                        
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <table class="table" id="recentBookingsTable">
                                            <thead>
                                                <tr>
                                                    <th>Name</th>
                                                    <th>Amount Paid</th>
                                                </tr>
                                            </thead>
                                            <tbody id="recentBookingsBody">
                                           
                                            </tbody>
                                        </table>
                                    </div>
                        </div>
                    </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-12">
                        <div class="card card-info card-route">
                            <div class="card-header">
                                <h3 class="card-title">Recent Vouchers</h3>
                                <div class="card-tools">
                               
                                </div>
                            </div>
                            <div class="card-body">
                                <table class="table" id="recentVouchersTable">
                                    <thead>
                                        <tr>
                                            <th>Type</th>
                                            <th>Date</th>
                                            <th>Account</th>
                                            <th>Voucher No</th>
                                            <th>Payment Type</th>
                                            <th>Amount</th>
                                        </tr>
                                    </thead>
                                    <tbody id="recentVouchersBody">
                                
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
          
        </div>
    </section>
<!-- /.content -->
{% endblock main_content %} {% block custom_js %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
<!-- Leaflet JavaScript -->
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
<!-- Include Chart.js library -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Fetch data from the server
        fetch('/active_user_list/')
            .then(response => response.json())
            .then(data => {
                const userListContainer = document.getElementById('activeUserList');
    
                // Clear existing content
                userListContainer.innerHTML = '';
    
                // Loop through the active user data and create elements
                data.forEach(user => {
                    const userContainer = document.createElement('div');
                    userContainer.classList.add('user-container');
    
                    // Display profile picture
                    const profilePicture = document.createElement('img');
                    profilePicture.src = user.profile_picture;
                    profilePicture.alt = 'Profile Picture';
                    profilePicture.classList.add('profile-picture');
                    userContainer.appendChild(profilePicture);
    
                    // Display name
                    const nameElement = document.createElement('div');
                    nameElement.innerText = user.username;
                    nameElement.classList.add('user-name');
                    userContainer.appendChild(nameElement);
    
                    // Display sign-in time
                    const signInTime = document.createElement('div');
                    signInTime.innerText = `Sign In Time: ${user.last_active}`;
                    signInTime.classList.add('sign-in-time');
                    userContainer.appendChild(signInTime);
    
                    // Display online/offline status
                    const statusElement = document.createElement('div');
                    statusElement.innerText = user.is_online ? 'Online' : 'Offline';
                    statusElement.classList.add(user.is_online ? 'online' : 'offline');
                    userContainer.appendChild(statusElement);
    
                    userListContainer.appendChild(userContainer);
                });
            })
            .catch(error => console.error('Error fetching active user data:', error));
    });
    </script>


<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Fetch data from the server
        fetch('/income_vs_expense_json/')
            .then(response => response.json())
            .then(data => {
                // Extract data for the chart
                const months = data.monthly_data.map(entry => entry.month);
                const incomeData = data.monthly_data.map(entry => entry.total_income);
                const expenseData = data.monthly_data.map(entry => entry.total_expense);
                const profitData = data.monthly_data.map(entry => entry.monthly_profit);

                // Create ApexCharts
                var options = {
                    chart: {
                        type: 'line',
                        height: 350
                    },
                    series: [
                        {
                            name: 'Total Income',
                            data: incomeData
                        },
                        {
                            name: 'Total Expense',
                            data: expenseData
                        },
                        {
                            name: 'Monthly Profit',
                            data: profitData
                        }
                    ],
                    xaxis: {
                        categories: months
                    }
                };

                var chart = new ApexCharts(document.querySelector("#incomeExpenseChart"), options);
                chart.render();
            })
            .catch(error => console.error('Error fetching data:', error));
    });
</script>

<script>
    document.addEventListener('DOMContentLoaded', function () {

        fetch('/recent_bookings/')
            .then(response => response.json())
            .then(data => {
      
                const recentBookingsBody = document.getElementById('recentBookingsBody');

                recentBookingsBody.innerHTML = '';

               
                const recentBookingsData = data.slice(0, 5);

              
                recentBookingsData.forEach(booking => {
                    const row = document.createElement('tr');
                    row.innerHTML = `<td>${booking['Customer Name']}</td><td>${booking['Amount Paid']}</td>`;
                    recentBookingsBody.appendChild(row);
                });
            })
            .catch(error => console.error('Error fetching recent bookings:', error));
    });
</script>








<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Fetch counter data from the API endpoint
        fetch('/counter_credit_balance/')  // Replace with your actual API endpoint
            .then(response => response.json())
            .then(data => {
                // Get the table body element
                const tableBody = document.getElementById('counterCreditBody');
    
                // Loop through the counter data and create table rows
                data.forEach(counter => {
                    const row = tableBody.insertRow();
                    const nameCell = row.insertCell(0);
                    const balanceCell = row.insertCell(1);

                    // Add "Tk" sign before the credit_balance
                    nameCell.innerText = `${counter.name}`;
                    balanceCell.innerText = `Tk ${counter.credit_balance}`;

                    // Check if credit_balance is less than 1000 and apply red color, otherwise apply green
                    if (parseFloat(counter.credit_balance) < 1000) {
                        balanceCell.style.color = 'red';
                    } else {
                        balanceCell.style.color = 'green';
                    }
                });
            })
            .catch(error => console.error('Error fetching counter data:', error));
    });
</script>


<script>
    document.addEventListener("DOMContentLoaded", function() {
        // Fetch recent voucher data from the Django view
        fetch('/recent_vouchers/')
            .then(response => response.json())
            .then(data => {
                // Handle the data and dynamically populate the table
                renderRecentVouchers(data.slice(0, 5)); // Show only the most recent 5 vouchers
            })
            .catch(error => console.error('Error fetching recent vouchers:', error));
    });
    
    function renderRecentVouchers(data) {
        const recentVouchersBody = document.getElementById('recentVouchersBody');
    
        // Clear existing content in the table body
        recentVouchersBody.innerHTML = '';
    
        // Iterate through the data and create table rows
        data.forEach(voucher => {
            const row = document.createElement('tr');
    
            row.innerHTML = `
                <td>${voucher.Type}</td>
                <td>${voucher.Date}</td>
                <td>${voucher.Account}</td>
                <td>${voucher['Voucher No']}</td>
                <td>${voucher['Payment Type']}</td>
                <td>${voucher.Amount}</td>
            `;
    
            recentVouchersBody.appendChild(row);
        });
    }
</script>
    
    
  

<script>
    $(document).ready(function(){

        var pieData = {
                labels: [
                    'Customers',
                    'Staffs',
                    'Bus'
                ],
                datasets: [
                    {
                        data: [{{ customer_count }},{{ staff_count }},{{ bus_count}}],
                        backgroundColor: ['#4C0080', '#ff6a00', '#19147b'],
                    }
                ]
        };

        var pieChartCanvas = $('#pieChart').get(0).getContext('2d')
        var pieOptions     = {
            maintainAspectRatio : false,
            responsive : true,
        }
        //Create pie or douhnut chart
        // You can switch between pie and douhnut using the method below.
        var pieChart = new Chart(pieChartCanvas, {
            type: 'pie',
            data: pieData,
            options: pieOptions
        });


        
        var price_label
        var month_label
            

        function monthlySalesChart(currenrYearPrices, lastYearPrices, months, totalPrice) {
        'use strict';
        
        var ticksStyle = {
            fontColor: '#495057',
            fontStyle: 'bold'
        };
        
        var mode = 'index';
        var intersect = true;
        
        var $salesChart = $('#sales-chart');
        var salesChart = new Chart($salesChart, {
            type: 'bar',
            data: {
                    labels: months,
                    datasets: [
                            {
                                    backgroundColor: '#007bff',
                                    borderColor: '#007bff',
                                    data: currenrYearPrices
                            },
                            {
                                    backgroundColor: '#ced4da',
                                    borderColor: '#ced4da',
                                    data: lastYearPrices
                            }
                    ]
            },
            options: {
                maintainAspectRatio: false,
                tooltips: {
                    mode: mode,
                    intersect: intersect
                },
                hover: {
                    mode: mode,
                    intersect: intersect
                },
                legend: {
                    display: false
                },
                scales: {
                    yAxes: [{
                        gridLines: {
                            display: true,
                            lineWidth: '4px',
                            color: 'rgba(0, 0, 0, .2)',
                            zeroLineColor: 'transparent'
                        },
                        ticks: $.extend({
                            beginAtZero: true,
                            callback: function (value) {
                                if (value >= 1000) {
                                    value /= 1000;
                                    value += 'k';
                                }
                                return '৳' + value;
                            }
                        }, ticksStyle)
                    }],
                    xAxes: [{
                        display: true,
                        gridLines: {
                            display: false
                        },
                        ticks: ticksStyle
                    }]
                }
            }
        });
        }
        
        $(function() {
            $.ajax({
                url: '/admin_home_data/',
                dataType: 'json',
                success: function(data) {
                        console.log(data);
                        currentYear = parseInt(data.current_year)
                        var lastYear = parseInt(data.last_year);

                        console.log('current_year:', currentYear);
                        console.log('test: ', data.booking_data[currentYear]);
                        var lastYearPriceLabel = data.booking_data[lastYear].monthly_sales_price;
                        var currentYearPriceLabel = data.booking_data[currentYear].monthly_sales_price;

                        var monthLabel = data.booking_data[currentYear].month;

                        console.log('price: ', currentYearPriceLabel);
                        console.log('month: ', monthLabel);
                        monthlySalesChart(currentYearPriceLabel, lastYearPriceLabel, monthLabel);
                },
                error: function(xhr, status, error) {
                        console.log('error');
                }
            });
        });
          


    });
  $(document).ready(function(){
        /*var pieData = {
                labels: [
                    'Customers',
                    'Staffs',
                    'Bus'
                ],
                datasets: [
                    {
                        data: [{{ customer_count }},{{ staff_count }},{{ bus_count}}],
                        backgroundColor : ['#4C0080', '#ff6a00', '#19147b'],
                    }
                ]
        };

        var pieChartCanvas = $('#pieChart').get(0).getContext('2d')
        var pieOptions     = {
            maintainAspectRatio : false,
            responsive : true,
        }
        //Create pie or douhnut chart
        // You can switch between pie and douhnut using the method below.
        var pieChart = new Chart(pieChartCanvas, {
            type: 'pie',
            data: pieData,
            options: pieOptions
        });*/

        //Second Chart for Total Subject in Each Course
            /*var subject_count_list={{ subject_count_list }}
            var course_name_list={{ course_name_list|safe }}
            var donutChartCanvas = $('#donutChart').get(0).getContext('2d')
            var donutData        = {
                labels:course_name_list,
                datasets: [
                    {
                        data: subject_count_list,
                        backgroundColor : ['#f56954', '#00a65a', '#f39c12', '#00c0ef', '#3c8dbc', '#d2d6de'],
                    }
                ]
            }
            var donutOptions     = {
                maintainAspectRatio : false,
                responsive : true,
            }
            //Create pie or douhnut chart
            // You can switch between pie and douhnut using the method below.
            var donutChart = new Chart(donutChartCanvas, {
                type: 'doughnut',
                data: donutData,
                options: donutOptions
            });*/


          //show total student in each course
          /*var student_count_list_in_course={{ student_count_list_in_course }};

            var pieData2 = {
                labels:course_name_list,
                datasets: [
                    {
                        data: student_count_list_in_course,
                        backgroundColor : ['#f56954', '#00a65a','#aa00ff', '#ff3d00'],
                    }
                ]
            };

            var pieChartCanvas2 = $('#pieChart3').get(0).getContext('2d')
            var pieOptions2     = {
                maintainAspectRatio : false,
                responsive : true,
            }
            var pieChart = new Chart(pieChartCanvas2, {
                type: 'pie',
                data: pieData2,
                options: pieOptions2
            });*/

          //show total student in each Subject
          /*var student_count_list_in_subject={{ student_count_list_in_subject }};
          var subject_list={{ subject_list|safe }};

            var pieData3  = {
                labels:subject_list,
                datasets: [
                    {
                        data: student_count_list_in_subject,
                        backgroundColor : ['#f56954', '#00a65a','#aa00ff', '#ff3d00','#bf360c','#ffff00','#00e676','#40c4ff','#f56954', '#00a65a','#aa00ff', '#ff3d00','#bf360c','#ffff00','#00e676','#40c4ff'],
                    }
                ]
            };

            var pieChartCanvas3 = $('#pieChart4').get(0).getContext('2d')
            var pieOption3     = {
                maintainAspectRatio : false,
                responsive : true,
            }
            var pieChart = new Chart(pieChartCanvas3, {
                type: 'pie',
                data: pieData3,
                options: pieOption3
            });

            ///Staff Leave vs Attendance Bar Chart
            var attendance_present_list_staff={{ attendance_present_list_staff }};
            var attendance_absent_list_staff={{ attendance_absent_list_staff }};
            var staff_name_list={{ staff_name_list|safe }};
            var barChartData = {
            labels  : staff_name_list,
            datasets: [
                {
                    label               : 'Leaves',
                    backgroundColor     : 'rgba(60,141,188,0.9)',
                    borderColor         : 'rgba(60,141,188,0.8)',
                    pointRadius          : false,
                    pointColor          : '#3b8bba',
                    pointStrokeColor    : 'rgba(60,141,188,1)',
                    pointHighlightFill  : '#fff',
                    pointHighlightStroke: 'rgba(60,141,188,1)',
                    data                : attendance_absent_list_staff
                },
                {
                    label               : 'Attendance',
                    backgroundColor     : 'rgba(210, 214, 222, 1)',
                    borderColor         : 'rgba(210, 214, 222, 1)',
                    pointRadius         : false,
                    pointColor          : 'rgba(210, 214, 222, 1)',
                    pointStrokeColor    : '#c1c7d1',
                    pointHighlightFill  : '#fff',
                    pointHighlightStroke: 'rgba(220,220,220,1)',
                    data                : attendance_present_list_staff
                },
            ]
            }
            var barChartCanvas = $('#barChart1').get(0).getContext('2d')
            var temp0 = barChartData.datasets[0]
            var temp1 = barChartData.datasets[1]
            barChartData.datasets[0] = temp1
            barChartData.datasets[1] = temp0

            var barChartOptions = {
                responsive              : true,
                maintainAspectRatio     : false,
                datasetFill             : false
            }

            var barChart = new Chart(barChartCanvas, {
                type: 'bar',
                data: barChartData,
                options: barChartOptions
            })

            //Student Leaves vs Attendance
            var attendance_present_list_student={{ attendance_present_list_student }};
            var attendance_absent_list_student={{ attendance_absent_list_student }};
            var student_name_list={{ student_name_list|safe }};
            var barChartData2 = {
            labels  : student_name_list,
            datasets: [
                {
                    label               : 'Leaves',
                    backgroundColor     : 'rgba(60,141,188,0.9)',
                    borderColor         : 'rgba(60,141,188,0.8)',
                    pointRadius          : false,
                    pointColor          : '#3b8bba',
                    pointStrokeColor    : 'rgba(60,141,188,1)',
                    pointHighlightFill  : '#fff',
                    pointHighlightStroke: 'rgba(60,141,188,1)',
                    data                : attendance_absent_list_student
                },
                {
                    label               : 'Attendance',
                    backgroundColor     : 'rgba(210, 214, 222, 1)',
                    borderColor         : 'rgba(210, 214, 222, 1)',
                    pointRadius         : false,
                    pointColor          : 'rgba(210, 214, 222, 1)',
                    pointStrokeColor    : '#c1c7d1',
                    pointHighlightFill  : '#fff',
                    pointHighlightStroke: 'rgba(220,220,220,1)',
                    data                : attendance_present_list_student
                },
            ]
            }
            var barChartCanvas2 = $('#barChart2').get(0).getContext('2d')
            var temp02 = barChartData2.datasets[0]
            var temp12 = barChartData2.datasets[1]
            barChartData2.datasets[0] = temp12
            barChartData2.datasets[1] = temp02

            var barChartOptions2 = {
                responsive              : true,
                maintainAspectRatio     : false,
                datasetFill             : false
            }

            var barChart2 = new Chart(barChartCanvas2, {
                type: 'bar',
                data: barChartData2,
                options: barChartOptions2
            })*/


      
  });
</script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script> 


<script>
    // Fetch data from Django API endpoint
    fetch('/get_customer_data/')
        .then(response => response.json())
        .then(data => {
            const dailyCustomerCounts = data.daily_customer_counts;

            // Update the customer overview chart
            var ctx = document.getElementById('customerOverviewChart').getContext('2d');
            var customerChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Array.from({ length: dailyCustomerCounts.length }, (_, i) => `Day ${i + 1}`),
                    datasets: [{
                        label: "Daily Customer Count",
                        data: dailyCustomerCounts,
                        backgroundColor: 'rgba(255, 99, 132, 0.2)',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 1,
                        fill: true,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            display: true,
                            title: {
                                display: true,
                                text: 'Day'
                            }
                        },
                        y: {
                            display: true,
                            title: {
                                display: true,
                                text: 'Customer Count'
                            }
                        }
                    }
                }
            });
        })
        .catch(error => {
            console.error('Error fetching customer data:', error);
        });
</script>
<script>
    // Initialize the map
    var map = L.map('map').setView([23.6850, 90.3563], 7); // Set the initial view to Bangladesh
  
    // Add a tile layer to the map (you can replace this with your preferred tile layer)
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '© OpenStreetMap contributors'
    }).addTo(map);
  
    // Load and display GeoJSON data
    $.getJSON("static/json/bangladesh.geojson", function(data) {
        L.geoJSON(data, {
            style: {
                  // Customize the border color
                fillOpacity: 0.1 // Customize the fill opacity
            }
        }).addTo(map);
    });
  
    // Add map pins (markers) to specific locations
    var marker = L.marker([23.8103, 90.4125]).addTo(map); // Example location for Dhaka
    marker.bindPopup("Dhaka"); // Add a popup to the marker
  
    // You can add more markers with similar code
  
  </script>


  <script>
    document.addEventListener('DOMContentLoaded', function () {
        // Function to fetch cash flow data from the server
        const fetchCashFlowData = async () => {
            try {
                const response = await fetch('/cash-flow-chart-data/');
                if (!response.ok) {
                    throw new Error('Failed to fetch data');
                }
                return await response.json();
            } catch (error) {
                console.error('Error fetching cash flow data:', error);
                return null;
            }
        };

        // Function to render the cash flow chart
        const renderCashFlowChart = (data) => {
            if (!data) {
                return; // Exit if data is not available
            }

            const cashFlowChartCanvas = document.getElementById('cash-flow-chart').getContext('2d');

            const cashFlowChartData = {
                labels: data.labels,
                datasets: [
                    {
                        label: 'Income',
                        data: data.datasets[0].data,
                        backgroundColor: data.datasets[0].backgroundColor,
                    },
                    {
                        label: 'Expense',
                        data: data.datasets[1].data,
                        backgroundColor: data.datasets[1].backgroundColor,
                    },
                ],
            };

            const cashFlowChartOptions = {
                maintainAspectRatio: false,
                responsive: true,
                scales: {
                    x: {
                        grid: {
                            display: false,
                        },
                    },
                    y: {
                        grid: {
                            display: true,
                        },
                    },
                },
            };

            new Chart(cashFlowChartCanvas, {
                type: 'bar',
                data: cashFlowChartData,
                options: cashFlowChartOptions,
            });
        };

        // Fetch data and render the chart on page load
        fetchCashFlowData().then(renderCashFlowChart);
    });
</script>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        fetch('/staff_booking_data/')  // Replace with your actual URL
            .then(response => response.json())
            .then(data => {
                var staffData = data.staff_data;
                var staffNames = staffData.map(staff => staff.name);
                var staffBookingTotals = staffData.map(staff => staff.total_bookings);

                var ctx = document.getElementById("staffBookingGraph").getContext("2d");
                var staffBookingChart = new Chart(ctx, {
                    type: "bar",
                    data: {
                        labels: staffNames,
                        datasets: [{
                            label: "Total Bookings",
                            data: staffBookingTotals,
                            backgroundColor: "rgba(54, 162, 235, 0.6)",
                            borderColor: "rgba(54, 162, 235, 1)",
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: "Total Bookings"
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: "Staff Names"
                                }
                            }
                        }
                    }
                });
            });
    });
</script>

<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script>
    fetch('/route_booking_count_graph/')
        .then(response => response.json())
        .then(data => {
            const routeNames = data.route_data.map(route => route.route_name);
            const bookingCounts = data.route_data.map(route => route.booking_count);

            const trace = {
                x: routeNames,
                y: bookingCounts,
                type: 'bar'
            };

            const layout = {
                title: 'Route Booking Ticket Count',
                xaxis: {
                    title: 'Routes'
                },
                yaxis: {
                    title: 'Booking Ticket Count'
                }
            };

            Plotly.newPlot('plotly-graph', [trace], layout);
        })
        .catch(error => console.error('Error fetching data:', error));
</script>
<script src="https://code.highcharts.com/highcharts.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Data for the pie chart (replace these values with your actual data)
        var data = {
            labels: ["Expense", "Income", "Bill"],
            datasets: [
                {
                    data: [
                        {{ total_expenses|default_if_none:0.00 }},
                        {{ total_income|default_if_none:0.00 }},
                        {{ total_bill_amount|default_if_none:0.00 }},
                    ],
                    backgroundColor: ["#FF5733", "#5DADE2", "#58D68D"],
                },
            ],
        };
    
        // Get the pie chart canvas
        var ctx = document.getElementById("pieChart").getContext("2d");
    
        // Create the pie chart
        var pieChart = new Chart(ctx, {
            type: "pie",
            data: data,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                legend: {
                    position: "bottom",
                },
            },
        });
    });
    </script>
{% endblock custom_js %}
