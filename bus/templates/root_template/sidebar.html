{% load static %} {% load perm_tags %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>


<link rel="stylesheet" href="{% static "dist/css/sidebar.css" %}"> 

<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<aside class="main-sidebar sidebar-dark-primary elevation-4">
    <!-- Brand Logo -->
    <a
    href=""
    class="brand-link"
    style="text-decoration: none; background-color: white"
    >
    
    <span class="brand-text font-weight-light">
        <img
        src="{% static 'img/igl.jpg'%}"
        alt=""
        style="width: 200px; height: 60px"
        />
    </span>
    </a>

    <!-- Sidebar -->
    <div class="sidebar">
    <!-- Sidebar user panel (optional) -->
    <div class="user-panel mt-3 pb-3 mb-3 d-flex">
        <div class="image">
        {% if request.user.profile_picture %}
        <img
            src="{{ request.user.profile_picture.url }}"
            class="img-circle elevation-2"
            alt="User Image"
        />
        {% else %}
        <img
            src="{% static 'dist/img/user2-160x160.jpg' %}"
            class="img-circle elevation-2"
            alt="User Image"
        />
        {% endif %}
        </div>
        <div class="info">
        <a href="{% url 'admin_profile' %}" class="d-block"
            >{{ request.user.username }}</a
        >
        {% if request.user.is_online %}
        <span class="online-indicator"></span
        ><span class="ml-2 text-muted">Online</span>
        {% endif %}
        </div>
    </div>
    <!-- Sidebar Menu -->
    <nav class="mt-2 sidebar-nav">
        <ul
        class="nav nav-pills nav-sidebar flex-column"
        data-widget="treeview"
        role="menu"
        data-accordion="false"
        >
    
        <li class="nav-item nav-item-link">
            <a href="{% url 'dashboard_root' %}"
                class="nav-link {% if request.path == '/dashboard_root' %} active {% endif %}">
                <i class="fa-solid fa-house fa-lg"></i>
                <p>Home</p>
            </a>
        </li>


        <li class="nav-item nav-item-link">
            <div class="iocn-link">
                <a
                    class="nav-link  counter-manager-btn sidebar-dropdown-link"
                    href="#"
                    id="counter-manager-dropdown"
                    role="button"
                    data-bs-toggle="dropdown"
                    aria-expanded="false"
                >
                    <i class="fa-solid fa-user fa-lg"></i>
                    <p>Create Company</p>
                    <i class="fa-solid fa-angle-down angle-icon"></i>
                </a>
            </div>
            <ul class="sub-menu counter-manager-show sidebar-dropdown-show">
                
            
                <li class="nav-item-dropdown">
                    {% url 'create_company' as create_company%}
                    <a
                        href="{{ create_company }}"
                        class="dropdown-item {% if request.path == create_company %} active {% endif %}"
                        ><i class="fa-solid fa-circle-dot"></i>Create Company</a
                    >
                </li>
           
              
                <li class="nav-item-dropdown">
                    {% url 'company_list' as company_list %}
                    <a
                        href="{{ company_list }}"
                        class="dropdown-item {% if request.path == company_list %} active {% endif %}"
                        ><i class="fa-solid fa-circle-dot"></i>Company List</a>
                </li>
              
            </ul>
        </li>



        <li class="nav-item nav-item-link">
            <div class="iocn-link">
                <a
                    class="nav-link {% if request.path == '/staff-types/' or request.path == '/manage_assigned_staff/' %} active {% endif %} coach-btn sidebar-dropdown-link"
                    href="#"
                    id="coach-dropdown"
                    role="button"
                    data-bs-toggle="dropdown"
                    aria-expanded="false"
                >
                    <i class="fa-solid fa-users fa-lg"></i>
                    <p>Department</p>
                    <i class="fa-solid fa-angle-down angle-icon"></i>
                </a>

            </div>
            <ul class="sub-menu coach-show sidebar-dropdown-show">
            
                <li class="nav-item-dropdown">
                    {% url 'staff_type_list' as staff_type_list%}
                    <a href="{{ staff_type_list }}"
                        class="dropdown-item {% if request.path == staff_type_list %} active {% endif %}"
                    ><i class="fa-solid fa-circle-dot"></i>Department List</a>
                </li>
            
            
                <li class="nav-item-dropdown">
                    <a href="{% url 'assigned_staff_types_list'  %}"
                       class="dropdown-item {% if request.path == assigned_staff_types_list %} active {% endif %}">
                        <i class="fa-solid fa-circle-dot"></i>Assign
                    </a>
                </li>
            
            </ul>
        </li>

        {% comment %} <li class="nav-item nav-item-link">
            {% url 'create_company' as create_company%}
            <a
              href="{{ create_company }}"
              class="nav-link {% if request.path == user_list %} active {% endif %}"
            >
            <i class="fa fa-user-plus fa-lg" aria-hidden="true"></i>
                <p>Create company</p>
            </a>
        </li>

         {% endcomment %}
    







        
      



        
    

      
        {% comment %} {% if request.user|has_perm:'bus.add_ticketbooking' or request.user|has_perm:'bus.view_ticketbooking' or request.user|has_perm:'bus.change_ticketbooking' or request.user|has_perm:'bus.delete_ticketbooking' %}
        <li class="nav-item">
            <div class="iocn-link">
                <a
                class="nav-link dropdown-toggle ticket-btn"
                href="#"
                id="ticket-dropdown"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
                >
                <i class="fa-solid fa-ticket fa-lg"></i>
                <p>Ticket Booking</p>
                </a>
                <i class="bx bxs-chevron-down arrow"></i>
            </div>
            <ul class="sub-menu ticket-show">
                {% if request.user|has_perm:'bus.add_ticketbooking' %}
                <li>
                {% url 'search_form' as search_form %}
                <a href="{{ search_form }}"
                    class="dropdown-item {% if request.path == search_form %} active {% endif %}"
                >Book Ticket</a>
                </li>
                {% endif %}
                {% if request.user|has_perm:'bus.view_ticketbooking' or request.user|has_perm:'bus.change_ticketooking' or request.user|has_perm:'bus.delete_ticketbooking' %}
                <li>
                {% url 'booking_list' as booking_list %}
                <a href="{{ booking_list }}"
                    class="nav-link {% if request.path == booking_list %} active {% endif %}"
                >
                    <p>Ticket List</p>
                </a>
                </li>
                {% endif %}
            </ul>
        </li>
        {% endif %} {% endcomment %}

      

       


        </ul>
    </nav>
    <!-- /.sidebar-menu -->
    </div>
    <!-- /.sidebar -->
</aside>

{% block custom_js %}
{% comment %} <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  $(document).ready(function () {
    $(".counter-manager-btn").click(function () {
      $(".sidebar-nav ul .counter-manager-show").toggleClass("show");
      console.log("clicked");
    });

    $(".routes-btn").click(function () {
      $(".sidebar-nav ul .routes-show").toggleClass("show");
      console.log("clicked");
    });

    $(".counter-btn").click(function () {
      $(".sidebar-nav ul .counter-show").toggleClass("show");
      console.log("clicked");
    });

    $(".coach-btn").click(function () {
      $(".sidebar-nav ul .coach-show").toggleClass("show");
      console.log("clicked");
    });

    $(".pages-btn").click(function () {
      $(".sidebar-nav ul .pages-show").toggleClass("show");
      console.log("clicked");
    });

    // Check if a submenu link is active on page load
    $(".sub-menu a").each(function () {
      var linkHref = $(this).attr("href");
      if (linkHref === window.location.pathname) {
        $(this).closest(".sub-menu").addClass("show");
      }
    });
  }); {% endcomment %}


<script>
    $(document).ready(function () {
        /*$(".counter-manager-btn").click(function () {
            $(".sidebar-nav ul .counter-manager-show").toggleClass("show");
            console.log("clicked");
        });

        $(".routes-btn").click(function () {
            $(".sidebar-nav ul .routes-show").toggleClass("show");
            console.log("clicked");
        });

        $(".counter-btn").click(function () {
            $(".sidebar-nav ul .counter-show").toggleClass("show");
            console.log("clicked");
        });

        $(".coach-btn").click(function () {
            $(".sidebar-nav ul .coach-show").toggleClass("show");
            console.log("clicked");
        });

        $(".pages-btn").click(function () {
            $(".sidebar-nav ul .pages-show").toggleClass("show");
            console.log("clicked");
        });*/

        // Check if a submenu link is active on page load
        $(".sub-menu a").each(function () {
            var linkHref = $(this).attr("href");
            if (linkHref === window.location.pathname) {
                var firstParent = $(this).closest(".sub-menu")
                var secondParent = firstParent.closest(".sidebar-dropdown-show")
                firstParent.addClass("show");
                secondParent.addClass("show");
                console.log('firstParent: ', firstParent)
                console.log('secondParent: ', secondParent)
            }
        });

        $(".sidebar-dropdown-link").on("click", function(e) {
            e.preventDefault();
        
            var $this = $(this);
        
            // Find the closest ancestor that contains both the link and the sub-menu
            var parentContainer = $this.closest(".nav-item-link");
            
            // Find the sub-menu element within the parent container
            var subMenu = parentContainer.find(".sidebar-dropdown-show");
            var angleIcon = $(this).find('.angle-icon')
            
            console.log('submenu: ', subMenu);
            //subMenu.toggleClass("show")
        
            // Check if the clicked sub-menu is already shown
            if (!subMenu.hasClass("show")) {
                // Hide all other sub-menus
                $(".sidebar-dropdown-show").removeClass("show");
                $('.angle-icon').removeClass("rotate");
                // Check if a submenu link is active on page load
                $(".sub-menu a").each(function () {
                    var linkHref = $(this).attr("href");
                    if (linkHref === window.location.pathname) {
                        $(this).closest(".sub-menu").addClass("show");
                    }
                });
                subMenu.addClass("show");
                angleIcon.addClass("rotate");
            }

            else {
                // Hide the clicked sub-menu
                subMenu.removeClass("show");
                angleIcon.removeClass("rotate");
            }
        });

        $('.second-sidebar-dropdown-link').on('click', function(e){
            e.preventDefault();

            var parentContainer = $(this).closest(".second-nav-item-link");
            var secondSubMenu = parentContainer.find(".second-sidebar-dropdown-show");
            var secondAngleIcon = $(this).find('.second-angle-icon')

            console.log('submenu: ', secondSubMenu);
            //subMenu.toggleClass("show")
        
            // Check if the clicked sub-menu is already shown
            if (!secondSubMenu.hasClass("show")) {
                // Hide all other sub-menus
                $(".second-sidebar-dropdown-show").removeClass("show");
                $('.second-angle-icon').removeClass("rotate");
                // Check if a submenu link is active on page load
                $(".sub-menu a").each(function () {
                    var linkHref = $(this).attr("href");
                    if (linkHref === window.location.pathname) {
                        $(this).closest(".sub-menu").closest(".sub-menu").addClass("show");
                    }
                });
                secondSubMenu.addClass("show");
                secondAngleIcon.addClass("rotate");
            }
            else {
                // Hide the clicked sub-menu
                secondSubMenu.removeClass("show");
                secondAngleIcon.removeClass("rotate");
            }

        })

    });

</script>
{% endblock custom_js %}
